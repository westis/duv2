# DUV Ultramarathon Statistics API: Authentication & Authorization

This document outlines the authentication mechanisms and authorization rules for the DUV Ultramarathon Statistics API.

## 1. Authentication Mechanisms

### 1.1 API Key Authentication

The primary authentication mechanism for the DUV Ultramarathon Statistics API is API Key authentication.

**Implementation Details:**

- API keys are generated through the DUV administrative interface
- Each API key is associated with a specific client application and usage tier
- API keys should be included in the HTTP header of each request: `X-API-Key: <your_api_key>`
- Keys follow a format of 32 random alphanumeric characters (e.g., `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`)

**Security Considerations:**

- API keys should be kept confidential and never exposed in client-side code
- Keys can be revoked or regenerated by administrators at any time
- Compromised keys should be reported immediately

### 1.2 JWT Authentication (Future Implementation)

For future iterations of the API, JWT (JSON Web Token) authentication may be implemented to support more advanced user-based scenarios.

**Implementation Details (Planned):**

- JWT issued after successful login with username/password
- Tokens will include user identity and role information
- Tokens will be short-lived (1 hour) with refresh token capability
- Tokens will be transmitted via the Authorization header: `Authorization: Bearer <token>`

## 2. Authorization Tiers

The API supports multiple tiers of access with different capabilities:

### 2.1 Public Tier (No Authentication)

- Limited to a subset of read-only operations
- Subject to strict rate limiting (60 requests per hour per IP)
- No access to detailed personal information

### 2.2 Basic Tier

- Requires API key authentication
- Access to all standard read-only endpoints
- Medium rate limits (1000 requests per hour)
- Limited access to runner personal details (respecting privacy settings)

### 2.3 Premium Tier

- Requires API key authentication
- Access to all read-only endpoints including enhanced data
- Higher rate limits (10,000 requests per hour)
- Access to bulk data retrieval operations
- Respect privacy settings but with more details available

### 2.4 Administrative Tier

- Requires API key authentication with administrative privileges
- Full access to all endpoints, including future write operations
- Minimal rate limiting
- Can override some privacy restrictions for legitimate purposes

## 3. Endpoint Authorization Matrix

| Endpoint                        | Public | Basic | Premium | Admin |
| ------------------------------- | ------ | ----- | ------- | ----- |
| GET /events                     | ✅     | ✅    | ✅      | ✅    |
| GET /events/{eventId}           | ✅     | ✅    | ✅      | ✅    |
| GET /events/{eventId}/results   | ✅\*   | ✅    | ✅      | ✅    |
| GET /results                    | ✅\*   | ✅    | ✅      | ✅    |
| GET /runners                    | ✅\*   | ✅    | ✅      | ✅    |
| GET /runners/{runnerId}         | ✅\*   | ✅    | ✅      | ✅    |
| GET /runners/{runnerId}/results | ✅\*   | ✅    | ✅      | ✅    |

\*Public access is limited (fewer records, less detailed information)

## 4. Data Privacy Considerations

### 4.1 Runner Privacy Settings

The database includes privacy settings for individual runners. These settings must be respected when returning data:

| Privacy Level | Description      | Public Tier                          | Basic Tier              | Premium Tier          | Admin Tier |
| ------------- | ---------------- | ------------------------------------ | ----------------------- | --------------------- | ---------- |
| 0             | No restrictions  | Full name, nationality, performances | All basic info          | All info              | All info   |
| 1             | Limited privacy  | Name, nationality, performances      | Basic info, no DOB      | Most info, no contact | All info   |
| 2             | Enhanced privacy | Last name initial only, performances | Last name initial only  | Limited info          | All info   |
| 3             | Maximum privacy  | Not visible in listings              | Not visible in listings | Limited data only     | All info   |

### 4.2 Age-Based Privacy

For all runners under 18 years of age (at time of performance or currently):

- Public tier: Display only last name initial, no birth year
- Basic tier: Display only last name initial, no exact birthdate
- Premium tier: Display full name but no birthdate details
- Admin tier: Full access

## 5. Rate Limiting

### 5.1 Implementation

Rate limits are implemented using a combination of:

- Per-API key limits (sliding window)
- Per-IP address limits (for public tier)

### 5.2 Rate Limit Headers

All responses include rate limit information in headers:

- `X-RateLimit-Limit`: Total requests allowed in period
- `X-RateLimit-Remaining`: Requests remaining in current period
- `X-RateLimit-Reset`: Time when the limit resets (Unix timestamp)

### 5.3 Tier-Specific Limits

| Tier    | Request Limit   | Time Window | Bulk Operations |
| ------- | --------------- | ----------- | --------------- |
| Public  | 60 requests     | Per hour    | No              |
| Basic   | 1,000 requests  | Per hour    | Limited         |
| Premium | 10,000 requests | Per hour    | Yes             |
| Admin   | 50,000 requests | Per hour    | Yes             |

## 6. Usage Tracking and Constraints

### 6.1 Usage Metrics

All API usage is tracked for:

- Billing purposes (for paid tiers)
- Abuse detection
- Performance optimization

### 6.2 Usage Constraints

Additional constraints apply:

- Maximum 100 records per page for all collection endpoints
- Bulk operations limited to specific time ranges depending on tier
- Query complexity limits to prevent excessive database load

## 7. Authentication Flow

### 7.1 API Key Registration Process

1. Client registers through the DUV administrative interface
2. Administrator approves registration and assigns appropriate tier
3. System generates API key
4. Key is securely delivered to the client

### 7.2 API Key Rotation

- Keys should be rotated periodically (recommended every 90 days)
- Old keys remain valid for a grace period (30 days) after new key issuance
- Automatic expiration can be enabled for enhanced security

## 8. Security Best Practices

1. All API requests must use HTTPS
2. API keys should never be embedded in mobile or frontend applications
3. Server-to-server communication is preferred for authenticated endpoints
4. Implement appropriate CORS policies for browser-based applications
5. Consider implementing request signing for high-security scenarios
